# --- CONFIGURATION GÉNÉRALE DE L'APPLICATION ---
# Nom de l'application
APP_NAME=fast-pin-pon-api
# Environnement d'exécution (development, production, test)
APP_ENV=development
# Niveau de granularité des logs (debug, info, warn, error)
LOG_LEVEL=info
# Port sur lequel le serveur écoute
PORT=9031

# --- CONFIGURATION SERVEUR HTTP ---
# Adresse d'écoute HTTP (ex: :8080 pour toutes les interfaces sur le port 8080)
HTTP_ADDRESS=:8080
# Temps limite pour la lecture de la requête
HTTP_READ_TIMEOUT=15s
# Temps limite pour l'écriture de la réponse
HTTP_WRITE_TIMEOUT=15s
# Temps limite pour les connexions inactives
HTTP_IDLE_TIMEOUT=60s

# --- CONFIGURATION BASE DE DONNÉES (POSTGRESQL) ---
# URL de connexion à la base de données
# Format: postgres://<user>:<password>@<host>:<port>/<dbname>?sslmode=<mode>
DB_URL=postgres://user:NB_PASSWORD_CHANGE_ME@postgres:5432/fastpinpon?sslmode=disable
# Exécuter les migrations de base de données au démarrage de l'application
DB_RUN_MIGRATIONS=true
# Dossier contenant les fichiers de migration SQL
DB_MIGRATIONS_DIR=migrations
# Nombre maximum de connexions simultanées à la base de données
DB_MAX_CONNS=20
# Temps maximum d'inactivité avant fermeture d'une connexion (format Go duration)
DB_MAX_CONN_IDLE_TIME=5m
# Durée de vie maximale d'une connexion (format Go duration)
DB_MAX_CONN_LIFETIME=30m


# --- CONFIGURATION KEYCLOAK (IAM) ---
# Port exposé pour Keycloak
KC_HOSTNAME_PORT=8080

# Identifiants Administrateur Keycloak (Bootstrap)
# Nom d'utilisateur de l'administrateur initial
KC_BOOTSTRAP_ADMIN_USERNAME=admin
# Mot de passe de l'administrateur initial - À CHANGER IMPÉRATIVEMENT
KC_BOOTSTRAP_ADMIN_PASSWORD=CHANGE_ME
# Email de l'administrateur système pour les notifications
MY_ADMIN_EMAIL=admin@example.com
# Prénom de l'admin
MY_ADMIN_FNAME=Admin
# Nom de l'admin
MY_ADMIN_LNAME=System

# Configuration du client Keycloak pour authentifier l'API et les services
# URL d'accès à Keycloak
KEYCLOAK_URL=http://localhost:8082
# Royaume (Realm) Keycloak utilisé
KEYCLOAK_REALM=sdmis-realm
# ID du client OpenID Connect
KEYCLOAK_CLIENT_ID=sdmis-api
# Secret du client OpenID Connect - À RÉCUPÉRER DEPUIS KEYCLOAK
KEYCLOAK_CLIENT_SECRET=CHANGE_ME


# Base de données utilisée par Keycloak
KC_DB=postgres
# URL JDBC de connexion à la base de données Keycloak
KC_DB_URL=jdbc:postgresql://keycloakdb:5432/keycloak
# Nom d'hôte public de Keycloak (pour les URLs de redirection)
KC_HOSTNAME=https://auth.example.com

# Identifiants Base de données Keycloak
# Nom de la base de données
KC_POSTGRES_DB=keycloak
# Utilisateur de la base de données
KC_POSTGRES_USER=keycloak
# Mot de passe de la base de données - À CHANGER
KC_POSTGRES_PASSWORD=CHANGE_ME

# --- SECRETS APPLICATIFS ---
# Token/Secret partagé pour la communication interne/API
CLIENT_SECRET_SDMIS_API=CHANGE_ME

# --- UTILISATEURS DE TEST ---
# Mots de passe par défaut pour les utilisateurs générés/de test - À CHANGER
PASSWORD_USER_TEST=CHANGE_ME
PASSWORD_USER=CHANGE_ME

# --- CONFIGURATION GRAFANA (MONITORING) ---
# Chemin relatif ou absolu vers le dossier contenant la configuration/provisioning Grafana
GRAFANA_PATH=/fast-pin-pon/infra/grafana

# Liste des plugins Grafana à installer au démarrage
PACKAGE_PLUGINS_GRAFANA=grafana-clock-panel,grafana-simple-json-datasource

# Secret pour le SSO Grafana (si applicable) - À CHANGER
GRAFANA_SSO=CHANGE_ME

# Identifiants Admin Grafana par défaut
GF_SECURITY_ADMIN_USER=admin
# Mot de passe Admin Grafana - À CHANGER
GF_SECURITY_ADMIN_PASSWORD=CHANGE_ME

# --- ACTIVATION OAUTH2 (SSO GRAFANA avec KEYCLOAK) ---
# Activer l'authentification OAuth2 générique
GF_AUTH_GENERIC_OAUTH_ENABLED=true
# Nom affiché sur le bouton de connexion
GF_AUTH_GENERIC_OAUTH_NAME=Keycloak
# Autoriser l'inscription automatique des utilisateurs via OAuth2
GF_AUTH_GENERIC_OAUTH_ALLOW_SIGN_UP=true
      
# Identifiants du Client Keycloak dédié à Grafana
GF_AUTH_GENERIC_OAUTH_CLIENT_ID=grafana
# Scopes demandés lors de l'authentification
GF_AUTH_GENERIC_OAUTH_SCOPES=openid profile email

# --- URLs OAuth2 (CRITIQUE pour le fonctionnement du SSO) ---
# URL d'autorisation (Redirection utilisateur)
GF_AUTH_GENERIC_OAUTH_AUTH_URL=https://auth.example.com/realms/sdmis-realm/protocol/openid-connect/auth
      
# URL pour l'échange de token (Communication Back-to-Back Grafana <-> Keycloak)
# Utiliser le nom du service docker si dans le même réseau
GF_AUTH_GENERIC_OAUTH_TOKEN_URL=http://fast-pin-pon-keycloak:8080/realms/sdmis-realm/protocol/openid-connect/token
# URL pour récupérer les infos utilisateur
GF_AUTH_GENERIC_OAUTH_API_URL=http://fast-pin-pon-keycloak:8080/realms/sdmis-realm/protocol/openid-connect/userinfo

# --- MAPPING DES RÔLES ---
# Expression JMESPath pour mapper les rôles Keycloak aux rôles Grafana (Admin/Viewer)
GF_AUTH_GENERIC_OAUTH_ROLE_ATTRIBUTE_PATH="contains(realm_access.roles[*], 'admin') && 'Admin' || 'Viewer'"